#!/bin/bash

pushd "/pkg/"

sudo chmod -R o+w+r $PKG_PATH

mkdir -p "$PKG_PATH/bin"
mkdir -p "$PKG_PATH/etc"

cp -r "telegraf-0.13.1-1/bin" "$PKG_PATH/bin"
chmod +x "$PKG_PATH/bin/telegraf"

cp "extra/telegraf-collector.conf" "$PKG_PATH/etc/telegraf-collector.conf"

popd
# systemd

export PKG_PATH=$PKG_PATH
systemd_master="$PKG_PATH"/dcos.target.wants_master/telegraf-forwarder.service
mkdir -p "$(dirname "$systemd_master")"
envsubst '$PKG_PATH' < /pkg/extra/telegraf-forwarder.service > "$systemd_master"
